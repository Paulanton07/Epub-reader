<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tauri API Debug</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .warning { background: #fff3cd; color: #856404; }
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            background: #007bff;
            color: white;
            cursor: pointer;
        }
        button:hover { background: #0056b3; }
        .code {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>üîß Tauri API Debug Tool</h1>
    
    <div id="status"></div>
    
    <button onclick="checkTauriAPI()">Check Tauri API</button>
    <button onclick="testFileDialog()">Test File Dialog</button>
    <button onclick="testInvoke()">Test Invoke</button>
    <button onclick="showWindowInfo()">Window Info</button>
    
    <div id="results"></div>
    
    <script>
        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.innerHTML = `<strong>${new Date().toLocaleTimeString()}:</strong> ${message}`;
            results.appendChild(div);
            console.log(message);
        }
        
        function checkTauriAPI() {
            log('Checking Tauri API availability...', 'info');
            
            const checks = {
                'window.__TAURI__': !!window.__TAURI__,
                'window.__TAURI_PLUGIN_DIALOG__': !!window.__TAURI_PLUGIN_DIALOG__,
                'window.__TAURI_INVOKE__': !!window.__TAURI_INVOKE__,
                'window.isTauri': !!window.isTauri,
                'window.__TAURI__.tauri': !!(window.__TAURI__ && window.__TAURI__.tauri),
                'window.__TAURI__.dialog': !!(window.__TAURI__ && window.__TAURI__.dialog),
                'window.__TAURI__.tauri.invoke': !!(window.__TAURI__ && window.__TAURI__.tauri && window.__TAURI__.tauri.invoke),
                'window.__TAURI__.dialog.open': !!(window.__TAURI__ && window.__TAURI__.dialog && window.__TAURI__.dialog.open)
            };
            
            let html = '<div class="code">';
            html += 'Tauri API Check Results:\n';
            
            for (const [key, value] of Object.entries(checks)) {
                html += `${key}: ${value ? '‚úÖ AVAILABLE' : '‚ùå MISSING'}\n`;
                if (value) {
                    log(`‚úÖ ${key} is available`, 'success');
                } else {
                    log(`‚ùå ${key} is missing`, 'error');
                }
            }
            
            html += '</div>';
            document.getElementById('results').innerHTML = html;
            
            // Check what's actually in __TAURI__
            if (window.__TAURI__) {
                log('__TAURI__ object contents: ' + JSON.stringify(Object.keys(window.__TAURI__), null, 2), 'info');
            }
        }
        
        async function testFileDialog() {
            log('Testing file dialog...', 'info');
            
            try {
                if (!window.__TAURI__ || !window.__TAURI__.dialog) {
                    throw new Error('Tauri dialog API not available');
                }
                
                const result = await window.__TAURI__.dialog.open({
                    multiple: false,
                    filters: [{
                        name: 'All Files',
                        extensions: ['*']
                    }]
                });
                
                if (result) {
                    log(`‚úÖ File dialog worked! Selected: ${result}`, 'success');
                } else {
                    log('‚ÑπÔ∏è File dialog opened but no file was selected', 'warning');
                }
            } catch (error) {
                log(`‚ùå File dialog failed: ${error.message}`, 'error');
            }
        }
        
        async function testInvoke() {
            log('Testing invoke...', 'info');
            
            try {
                if (!window.__TAURI__ || !window.__TAURI__.tauri || !window.__TAURI__.tauri.invoke) {
                    throw new Error('Tauri invoke API not available');
                }
                
                // Try a simple command that should exist
                const result = await window.__TAURI__.tauri.invoke('get_app_name');
                log(`‚úÖ Invoke worked! Result: ${JSON.stringify(result)}`, 'success');
            } catch (error) {
                log(`‚ùå Invoke failed: ${error.message}`, 'error');
            }
        }
        
        function showWindowInfo() {
            log('Gathering window information...', 'info');
            
            const info = {
                userAgent: navigator.userAgent,
                location: window.location.href,
                isSecureContext: window.isSecureContext,
                hasServiceWorker: 'serviceWorker' in navigator,
                windowName: window.name,
                windowOrigin: window.origin
            };
            
            let html = '<div class="code">Window Information:\n';
            for (const [key, value] of Object.entries(info)) {
                html += `${key}: ${value}\n`;
            }
            html += '</div>';
            
            document.getElementById('results').innerHTML = html;
            log('Window info displayed', 'info');
        }
        
        // Auto-check on load
        window.addEventListener('load', () => {
            log('Debug tool loaded', 'info');
            checkTauriAPI();
        });
        
        // Listen for Tauri events
        if (window.__TAURI__) {
            log('Setting up Tauri event listeners...', 'info');
        } else {
            log('Tauri not available - cannot set up event listeners', 'warning');
        }
    </script>
</body>
</html>
